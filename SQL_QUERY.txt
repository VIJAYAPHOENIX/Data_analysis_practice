CREATE TABLE accounts(
	id SERIAL PRIMARY KEY,
	name VARCHAR(20) NOT NULL,
	balance INTEGER NOT NULL
);

INSERT INTO accounts(name,balance)
VALUES
	('Gia',100),
	('Alyson',100);


SELECT *
FROM accounts;

UPDATE accounts
SET balance = balance - 50
WHERE name = 'Alyson';

SELECT * FROM accounts;


-------------RECURSIVE CTE ------------------------

WITH RECURSIVE suggestions AS (
	SELECT leader_id,follower_id,1 AS depth
	FROM Followers
	WHERE follower_id = 1
	UNION
	SELECT f.leader_id,f.follower_id,depth + 1
	FROM followers AS f
	JOIN suggestions ON suggestions.leader_id = f.follower_id
	WHERE depth < 3
)
SELECT DISTINCT users.id,users.username
FROM suggestions
JOIN users ON users.id = suggestions.leader_id
WHERE depth > 1
LIMIT 5;





-------------VIEW --------------

SELECT username,COUNT(*)
FROM users
JOIN(
	SELECT user_id FROM photo_tags
	UNION ALL
	SELECT user_id FROM caption_tags
) AS tags ON tags.user_id = users.id
GROUP BY username
ORDER BY COUNT(*) DESC;

-----------------CREATING A VIEW-------------------

CREATE VIEW tags AS (
	SELECT id,created_at,user_id,post_id,'photo_tag' AS type FROM photo_tags
	UNION ALL 
	SELECT  id,created_at,user_id,post_id,'caption_tag' AS type FROM caption_tags
);

